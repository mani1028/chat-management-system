<!DOCTYPE html>
<html>
<head>
    <title>Admin - CMR</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="navbar">
        <span>Admin Dashboard</span>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
    </div>

    <div class="container">
        <!-- Stats -->
        <div style="display:flex; gap:20px; margin-bottom:20px;">
            <div class="stat-box" style="background:#007bff;">
                <h3>{{ stats.projects }}</h3> <small>Projects</small>
            </div>
            <div class="stat-box" style="background:#28a745;">
                <h3>{{ stats.agents }}</h3> <small>Agents</small>
            </div>
            <div class="stat-box" style="background:#ffc107; color:#333;">
                <h3>{{ stats.active_chats }}</h3> <small>Active Chats</small>
            </div>
        </div>

        <!-- Project Management -->
        <div class="section">
            <h2>1. Projects</h2>
            <div style="display:flex; gap:20px; align-items:flex-start;">
                <div style="flex:1;">
                    <form action="{{ url_for('admin.create_project') }}" method="POST" class="form-card">
                        <h4>Create New Project</h4>
                        <input type="text" name="project_name" placeholder="Project Name (e.g. Website A)" required>
                        <input type="text" name="client_name" placeholder="Client Name" required>
                        <button type="submit" class="btn btn-primary">Create Project</button>
                    </form>
                </div>
                <div style="flex:2;">
                    <table>
                        <tr><th>ID</th><th>Project Name</th><th>Client</th><th>Integration Code</th></tr>
                        {% for p in projects %}
                        <tr>
                            <td>{{ p.id }}</td>
                            <td>{{ p.project_name }}</td>
                            <td>{{ p.client_name }}</td>
                            <td><code>?project_id={{ p.id }}</code></td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>

        <hr>

        <!-- Agent Management -->
        <div class="section">
            <h2>2. Agents</h2>
            <div style="display:flex; gap:20px; align-items:flex-start;">
                <div style="flex:1;">
                    <form action="{{ url_for('admin.create_agent') }}" method="POST" class="form-card">
                        <h4>Add Agent to Project</h4>
                        <input type="text" name="name" placeholder="Agent Name" required>
                        <input type="email" name="email" placeholder="Agent Email" required>
                        <input type="password" name="password" placeholder="Password" required>
                        <select name="project_id" required>
                            <option value="">Select Project...</option>
                            {% for p in projects %}
                            <option value="{{ p.id }}">{{ p.project_name }}</option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-success">Create Agent</button>
                    </form>
                </div>
                <div style="flex:2;">
                    <table>
                        <tr><th>Name</th><th>Email</th><th>Assigned Project</th><th>Status</th></tr>
                        {% for a in agents %}
                        <tr>
                            <td>{{ a.name }}</td>
                            <td>{{ a.email }}</td>
                            <td><strong>{{ a.project_name }}</strong></td>
                            <td>{{ a.status }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>

        <hr>

        <!-- Global Chat View -->
        <div class="section">
            <h2>3. Recent Chats (All Projects)</h2>
            <table>
                <tr><th>ID</th><th>Project</th><th>Customer</th><th>Agent</th><th>Status</th></tr>
                {% for c in chats %}
                <tr>
                    <td>{{ c.id }}</td>
                    <td>{{ c.project_name }}</td>
                    <td>{{ c.customer_name }}</td>
                    <td>{{ c.agent_name }}</td>
                    <td class="status-{{ c.status }}">{{ c.status }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

    </div>
</body>
</html>